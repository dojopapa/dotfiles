#==============================================================================
# Dependencies:
#    - tmux plugin manager: https://github.com/tmux-plugins/tpm
#    - Nerd font installed and enabled in terminal: 
#            www.nerdfonts.com/font-downloads
#
# Notes:
#    - To update plugins it may be necessary to manually run 
#            cd ~/.tmux/plugins/tpm/scripts && ./install_plugins.sh 
#      if the shortcut '<prefix> I' does not work
#
# References:
#    - https://www.youtube.com/watch?v=TwxgIPAg7gc&t=909s
#    - https://www.youtube.com/watch?v=6Jgl5wphD00
#==============================================================================

#------------------------------------------------------------------------------
# GENERAL SETTINGS
#------------------------------------------------------------------------------

set -g set-clipboard on		# use system clipboard
set -g mouse on			# enable mouse support
set -g status-interval 3	# update status bar every 3 seconds (default: 15)
set -g detach-on-destroy off	# do not exit tmux when closing a session

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on	# automatically renumber windows when one is closed

# Set fish as default shell
# set -g default-command /usr/bin/fish
set -g default-shell /usr/bin/fish

#------------------------------------------------------------------------------
# KEYBOARD SETTINGS
#------------------------------------------------------------------------------

# Set prefix key
unbind C-b			# unbind default prefix key
set -g prefix C-Space		# set new prefix key to Ctrl+Space

# Refresh tmux config with 'r'
unbind r
bind r source-file ~/.config/tmux/tmux.conf

# Split horizontally in CWD with '|'
unbind %
bind | split-window -h -c "#{pane_current_path}"

# Split vertically in CWD with '-'
unbind \"
bind - split-window -v -c "#{pane_current_path}"

# New window opens in same working directory (default: ~/)
unbind c
bind c new-window -c "#{pane_current_path}"

# Use "3D game arrow keys" to resize
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z # maximize pane

# Enhance copy mode
set-window-option -g mode-keys vi					# navigate with vim movements
bind-key -T copy-mode-vi 'v' send -X begin-selection			# start selecting text with 'v'
bind -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "xsel"	# copy text with 'y'
unbind -T copy-mode-vi MouseDragEnd1Pane				# do not exit copy mode when dragging with mouse


#------------------------------------------------------------------------------
# PLUGIN MANAGEMENT
#------------------------------------------------------------------------------

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

#set -g @plugin 'christoomey/vim-tmux-navigator'		# enable navigating between nvim and tmux (note: can cause lag, cf. https://medium.com/@musickcorym/fixing-the-lag-why-i-ditched-vim-tmux-navigator-for-a-faster-plugin-free-setup-239da138e4aa)
set -g @plugin 'tmux-plugins/tmux-resurrect'		# persist tmux sessions after computer restart
set -g @plugin 'tmux-plugins/tmux-continuum'		# automatically saves sessions every 15 minutes
set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor'		# CPU and memory info

set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
#set -g @resurrect-save-command-strategy 'pgrep'


#------------------------------------------------------------------------------
# APPEARANCE SETTINGS
#------------------------------------------------------------------------------

# Enable 256-color and true-color (24-bit) support
set -g default-terminal "screen-256color" 	# set terminal type for 256-color support
set -ga terminal-overrides ",*256col*:Tc" 	# override to enable true-color for compatible terminals

# Custom theme
gray_light="#D8DEE9"
gray_medium="#ABB2BF"
gray_dark="#3B4252"
green_soft="#A3BE8C"
green_muted="#81A1C1"
blue_muted="#81A1C1"
cyan_soft="#88C0D0"

set -g status-position top
set -g status-right " #{cpu -i 3}   #{mem} "	# CPU and memory on right status bar
set -g status-justify centre			# center window list on status bar
set -g status-right-length 200 			# increase length of right status bar area (default: 10)
set -g status-left-length 200			# increase length of left status bar area (default: 10)

set -g status-style "bg=${gray_dark}"
set -g status-left "#[fg=${green_soft},bold]  #S"
set -g window-status-current-format "#[fg=${cyan_soft},bold,bg=default]  #[underscore]#I:#W"
set -g window-status-format " #I:#W"
set -g message-style "fg=${gray_light},bg=${gray_dark}"
set -g mode-style "fg=${gray_dark},bg=${blue_muted}"
set -g pane-active-border-style "fg=${gray_medium},bg=default"
set -g pane-border-style "fg=${gray_dark},bg=default"

#------------------------------------------------------------------------------

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

